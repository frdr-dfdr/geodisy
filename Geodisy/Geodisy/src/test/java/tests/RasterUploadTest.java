package tests;

import Crosswalking.JSONParsing.DataverseParser;
import Dataverse.DataverseGeoRecordFile;
import Dataverse.DataverseJSONFieldClasses.Fields.DataverseJSONGeoFieldClasses.GeographicBoundingBox;
import Dataverse.DataverseJavaObject;
import Dataverse.DataverseRecordFile;
import GeoServer.GeoServerAPI;
import org.json.JSONObject;
import org.junit.jupiter.api.Test;

import static _Strings.DVFieldNameStrings.RECORD_LABEL;
import static _Strings.GeodisyStrings.TEST;

public class RasterUploadTest {
    @Test
    public void testRasterUpload() {
        TEST = true;
        String metadata = "{\"id\":62628,\"identifier\":\"SP/IT2CRA\",\"persistentUrl\":\"https://doi.org/10.5683/SP/IT2CRA\",\"protocol\":\"doi\",\"authority\":\"10.5683\",\"publisher\":\"Scholars Portal Dataverse\",\"publicationDate\":\"2018-02-14\",\"storageIdentifier\":\"file://10.5683/SP/IT2CRA\",\"datasetVersion\":{\"id\":3529,\"storageIdentifier\":\"file://10.5683/SP/IT2CRA\",\"versionNumber\":1,\"versionMinorNumber\":1,\"versionState\":\"RELEASED\",\"productionDate\":\"Production Date\",\"lastUpdateTime\":\"2018-02-14T21:43:32Z\",\"releaseTime\":\"2018-02-14T21:43:32Z\",\"createTime\":\"2018-02-14T21:43:12Z\",\"license\":\"CC0\",\"termsOfUse\":\"CC0 Waiver\",\"fileAccessRequest\":false,\"metadataBlocks\":{\"citation\":{\"displayName\":\"Citation Metadata\",\"fields\":[{\"typeName\":\"title\",\"multiple\":false,\"typeClass\":\"primitive\",\"value\":\"Geo-referenced Historic Maps of the Porcupine Gold Fields\"},{\"typeName\":\"author\",\"multiple\":true,\"typeClass\":\"compound\",\"value\":[{\"authorName\":{\"typeName\":\"authorName\",\"multiple\":false,\"typeClass\":\"primitive\",\"value\":\"Jorgenson, Mica\"},\"authorAffiliation\":{\"typeName\":\"authorAffiliation\",\"multiple\":false,\"typeClass\":\"primitive\",\"value\":\"McMaster University\"}}]},{\"typeName\":\"datasetContact\",\"multiple\":true,\"typeClass\":\"compound\",\"value\":[{\"datasetContactName\":{\"typeName\":\"datasetContactName\",\"multiple\":false,\"typeClass\":\"primitive\",\"value\":\"Jorgenson, Mica\"},\"datasetContactAffiliation\":{\"typeName\":\"datasetContactAffiliation\",\"multiple\":false,\"typeClass\":\"primitive\",\"value\":\"McMaster University\"},\"datasetContactEmail\":{\"typeName\":\"datasetContactEmail\",\"multiple\":false,\"typeClass\":\"primitive\",\"value\":\"jorgenma@mcmaster.ca\"}}]},{\"typeName\":\"dsDescription\",\"multiple\":true,\"typeClass\":\"compound\",\"value\":[{\"dsDescriptionValue\":{\"typeName\":\"dsDescriptionValue\",\"multiple\":false,\"typeClass\":\"primitive\",\"value\":\"Tiff files of historic maps of the Porcupine/Timmins mining district. Dataset includes georeferenced files ready for image overlay.\\r\\n\\r\\nIncludes: Claim boundaries, township boundaries, geological features, waterways, transportation infrastructure.\\r\\n\\r\\nCan be explored on ArcGIS Online: http://www.arcgis.com/apps/View/index.html?appid=053c6c8abc224bea8be64a4b8a44a8e0\"}}]},{\"typeName\":\"subject\",\"multiple\":true,\"typeClass\":\"controlledVocabulary\",\"value\":[\"Arts and Humanities\"]},{\"typeName\":\"keyword\",\"multiple\":true,\"typeClass\":\"compound\",\"value\":[{\"keywordValue\":{\"typeName\":\"keywordValue\",\"multiple\":false,\"typeClass\":\"primitive\",\"value\":\"maps, mining, GIS, overlay\"}}]},{\"typeName\":\"publication\",\"multiple\":true,\"typeClass\":\"compound\",\"value\":[{\"publicationURL\":{\"typeName\":\"publicationURL\",\"multiple\":false,\"typeClass\":\"primitive\",\"value\":\"http://www.arcgis.com/apps/View/index.html?appid=053c6c8abc224bea8be64a4b8a44a8e0\"}}]},{\"typeName\":\"depositor\",\"multiple\":false,\"typeClass\":\"primitive\",\"value\":\"Jorgenson, Mica\"},{\"typeName\":\"dateOfDeposit\",\"multiple\":false,\"typeClass\":\"primitive\",\"value\":\"2018-02-14\"},{\"typeName\":\"timePeriodCovered\",\"multiple\":true,\"typeClass\":\"compound\",\"value\":[{\"timePeriodCoveredStart\":{\"typeName\":\"timePeriodCoveredStart\",\"multiple\":false,\"typeClass\":\"primitive\",\"value\":\"1909\"},\"timePeriodCoveredEnd\":{\"typeName\":\"timePeriodCoveredEnd\",\"multiple\":false,\"typeClass\":\"primitive\",\"value\":\"1912\"}}]},{\"typeName\":\"dataSources\",\"multiple\":true,\"typeClass\":\"primitive\",\"value\":[\"Map of the Porcupine Gold Area 1912 (By: A.G. Burrows & W.R. Rogers, source: Ontario Bureau of Mines)\\r\\nMap of the Porcupine Gold Fields 1911 (By: J.T. Eastwood, source: Library and Archives Canada)\\r\\nMap of the Porcupine Gold Area 1911 (By: A.G. Burrows & W.R. Rogers, source: Ontario Bureau of Mines)\\r\\nThe Porcupine Gold District 1910 (By: H.P. Davis, source: Library and Archives Canada)\"]}]},\"geospatial\":{\"displayName\":\"Geospatial Metadata\",\"fields\":[]},\"journal\":{\"displayName\":\"Journal Metadata\",\"fields\":[]}},\"files\":[{\"label\":\"1910_rectified.tif\",\"restricted\":false,\"version\":1,\"datasetVersionId\":3529,\"dataFile\":{\"id\":62632,\"persistentId\":\"\",\"pidURL\":\"\",\"filename\":\"1910_rectified.tif\",\"contentType\":\"image/tiff\",\"filesize\":28412688,\"storageIdentifier\":\"1619630d27d-73119a2a172a\",\"rootDataFileId\":-1,\"md5\":\"02f9273a48d4bed8f2d57cb0cd66bded\",\"checksum\":{\"type\":\"MD5\",\"value\":\"02f9273a48d4bed8f2d57cb0cd66bded\"},\"creationDate\":\"2018-02-14\"}},{\"label\":\"Porcupine_1910rectified.tif\",\"restricted\":false,\"version\":1,\"datasetVersionId\":3529,\"dataFile\":{\"id\":62631,\"persistentId\":\"\",\"pidURL\":\"\",\"filename\":\"Porcupine_1910rectified.tif\",\"contentType\":\"image/tiff\",\"filesize\":28413189,\"storageIdentifier\":\"1619627f5e0-1eb00ac1d206\",\"rootDataFileId\":-1,\"md5\":\"23bd221753249e26b916249da5dac388\",\"checksum\":{\"type\":\"MD5\",\"value\":\"23bd221753249e26b916249da5dac388\"},\"creationDate\":\"2018-02-14\"}},{\"label\":\"porcupine1911_rectified.tif\",\"restricted\":false,\"version\":1,\"datasetVersionId\":3529,\"dataFile\":{\"id\":62634,\"persistentId\":\"\",\"pidURL\":\"\",\"filename\":\"porcupine1911_rectified.tif\",\"contentType\":\"image/tiff\",\"filesize\":51614320,\"storageIdentifier\":\"16196317cc8-1b48482a3992\",\"rootDataFileId\":-1,\"md5\":\"690c931ac57eeb5bdcbdf2c6f5ebad32\",\"checksum\":{\"type\":\"MD5\",\"value\":\"690c931ac57eeb5bdcbdf2c6f5ebad32\"},\"creationDate\":\"2018-02-14\"}},{\"label\":\"Porcupine_1912_rectified.tif\",\"restricted\":false,\"version\":1,\"datasetVersionId\":3529,\"dataFile\":{\"id\":62633,\"persistentId\":\"\",\"pidURL\":\"\",\"filename\":\"Porcupine_1912_rectified.tif\",\"contentType\":\"image/tiff\",\"filesize\":176765496,\"storageIdentifier\":\"16196316b99-ac6845b123a4\",\"rootDataFileId\":-1,\"md5\":\"f8278e4f5e994f133fc1e5a2d1dac36f\",\"checksum\":{\"type\":\"MD5\",\"value\":\"f8278e4f5e994f133fc1e5a2d1dac36f\"},\"creationDate\":\"2018-02-14\"}},{\"label\":\"PorcupineGoldFields_1910Rectified.tif\",\"restricted\":false,\"version\":1,\"datasetVersionId\":3529,\"dataFile\":{\"id\":62630,\"persistentId\":\"\",\"pidURL\":\"\",\"filename\":\"PorcupineGoldFields_1910Rectified.tif\",\"contentType\":\"image/tiff\",\"filesize\":28413189,\"storageIdentifier\":\"1619628003a-74fdd8ab5975\",\"rootDataFileId\":-1,\"md5\":\"23ef6b3fed26b4e86e8f6462982c33a5\",\"checksum\":{\"type\":\"MD5\",\"value\":\"23ef6b3fed26b4e86e8f6462982c33a5\"},\"creationDate\":\"2018-02-14\"}},{\"label\":\"PorcupineGoldFields_Redtified.tif\",\"restricted\":false,\"version\":1,\"datasetVersionId\":3529,\"dataFile\":{\"id\":62629,\"persistentId\":\"\",\"pidURL\":\"\",\"filename\":\"PorcupineGoldFields_Redtified.tif\",\"contentType\":\"image/tiff\",\"filesize\":51614821,\"storageIdentifier\":\"16196280f78-327422e25b34\",\"rootDataFileId\":-1,\"md5\":\"0dba56307084bf045345341dd2a6d36a\",\"checksum\":{\"type\":\"MD5\",\"value\":\"0dba56307084bf045345341dd2a6d36a\"},\"creationDate\":\"2018-02-14\"}}],\"citation\":\"Jorgenson, Mica, 2018, \\\"Geo-referenced Historic Maps of the Porcupine Gold Fields\\\", https://doi.org/10.5683/SP/IT2CRA, Scholars Portal Dataverse, V1\"}}";
        DataverseParser parser = new DataverseParser();
        JSONObject jo = new JSONObject(metadata);
        DataverseJavaObject djo = parser.parse(jo, "another fake server name");
        DataverseRecordFile recordFile = new DataverseRecordFile(djo.getSimpleFieldVal(RECORD_LABEL), new GeographicBoundingBox(djo.getSimpleFieldVal(RECORD_LABEL)));
        recordFile.setOriginalTitle("1910_rectified.tif");
        recordFile.setTranslatedTitle("1910_rectified.tif");
        recordFile.setProjection("EPSG:32633");
        DataverseGeoRecordFile geoRecordFile = new DataverseGeoRecordFile(recordFile);
        GeoServerAPI geoServerAPI = new GeoServerAPI(djo);
        geoServerAPI.addRaster(geoRecordFile);
    }
}
